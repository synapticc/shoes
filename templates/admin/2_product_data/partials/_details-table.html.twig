<main class="content">
  <!-- Topmost navbar -->
  {% include 'admin/_partials/navbar-top.html.twig'  %}
  <!-- Breadcrumbs -->
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb breadcrumb-dark breadcrumb-transparent">
      <li class="breadcrumb-item">
        <a href="{{ path('admin')}}"><span class="fas fa-home"></span></a>
      </li>
      <li class="breadcrumb-item">Product details</li>
      <li class="breadcrumb-item active {{ app.user.theme == 'dark' ? 'text-gray-700' }}" aria-current="page">
        <a href="{{ path('admin_product_data_index') }}">Details</a>
      </li>
    </ol>
  </nav>
  <!-- Page overview & Search bar -->
  <div class="d-flex justify-content-start w-100 flex-wrap">
    {% set features =
        ['Display all product details',
         'Edit specific detail',
         'Create new product detail'] %}
    <div class="col-3 mb-3 mb-lg-0 pr-3">
      <h1 class="h4 pb-3">Product details</h1>
      <!-- Page overview -->
      <ul>
        {% for feature in features %}
        <li class="mb-0 {{ app.user.theme == 'dark' ? 'text-gray-500'  }}">{{feature|capitalize}}.</li>
        {% endfor %}
      </ul>
    </div>
    <!-- Search form -->
    {% include 'admin/2_product_data/partials/_search-form.html.twig' %}
  </div>
  <!-- No. of items per page> -->
  {% if app.current_route  == 'admin_product_data_color' %}
    {% include 'admin/2_product_data/partials/_select-items.html.twig'
       with { 'items' : productData, 'item' : 'product detail','route_index': 'admin_product_data_index', 'route': '' } %}
  {% else %}
    {% include 'admin/_partials/select-items.html.twig'
         with { 'items' : productData, 'item' : 'product detail','route_index': 'admin_product_data_index', 'route': '' } %}
  {% endif %}

  <div class="row mt-1">
    <div class="col-lg-12 grid-margin stretch-card">
      <div class="card {{ app.user.theme == 'dark' ? 'bg-gray-300' }} border-light shadow-sm components-section">
        <div class="card-body">
          <div class="table-responsive" id="details-table">
            <!-- Table starts -->
            <table class="table table-centered table-nowrap mb-0 rounded">
              <!-- Table header starts -->
              <thead class="thead {{ app.user.theme == 'light' ? 'thead-light' : 'bg-gray-500' }}">
                <tr class="text-center table-header">
                  <!-- ID header -->
                  <th title="ProductData ID â†‘" class="table-id">
                    <span>ID</span>
                    {% include 'admin/2_product_data/partials/_sort-form.html.twig' with {'label': 'ID', 'sort_param': 'id'}  %}
                  </th>
                  <!-- Thumbnail header -->
                  <th title="Thumbnail" class="table-display">
                    <span>Thumbnail</span>
                    {% include 'admin/2_product_data/partials/_sort-form.html.twig' with {'label': 'color', 'sort_param': 'c.color'}  %}
                  </th>
                  <!-- Brand header -->
                  <th class="table-id">
                    <span>Brand</span>
                    {% include 'admin/2_product_data/partials/_sort-form.html.twig' with {'label': 'brand', 'sort_param': 'brand'}  %}
                  </th>
                  <!-- Product header -->
                  <th class="table-name text-left">
                    <span>Product</span>
                    {% include 'admin/2_product_data/partials/_sort-form.html.twig' with {'label': 'product', 'sort_param': 'name'}  %}
                  </th>
                  <!-- Quantity header -->
                  <th>
                    <span>Quantity</span>
                    {% include 'admin/2_product_data/partials/_sort-form.html.twig' with {'label': 'quantity', 'sort_param': 'qty'}  %}
                  </th>
                  <!-- Actions header -->
                  <th>Actions</th>
                  <!-- Size header -->
                  <th>
                    <span>Size</span>
                    {% include 'admin/2_product_data/partials/_sort-form.html.twig' with {'label': 'size', 'sort_param': 'p.size'}  %}
                  </th>
                  <!-- Selling price header -->
                  <th>
                    <span>Price (SP)</span>
                    {% include 'admin/2_product_data/partials/_sort-form.html.twig' with {'label': 'selling price', 'sort_param': 'p.selling_price'}  %}
                  </th>
                  <!-- Cost price header -->
                  <th>
                    <span>Price (CP)</span>
                    {% include 'admin/2_product_data/partials/_sort-form.html.twig' with {'label': 'cost price', 'sort_param': 'p.cost_price'}  %}
                  </th>
                  <th>
                    <span>Profit</span>
                    {% include 'admin/2_product_data/partials/_sort-form.html.twig' with {'label': 'profit', 'sort_param': 'profit'}  %}
                  </th>
                  <th>
                    <span>SKU</span>
                    {% include 'admin/2_product_data/partials/_sort-form.html.twig' with {'label': 'SKU', 'sort_param': 'p.sku'}  %}
                  </th>
                  <th>
                    <span>Supplier</span>
                    {% include 'admin/2_product_data/partials/_sort-form.html.twig' with {'label': 'supplier', 'sort_param': 'supplier'}  %}
                  </th>
                  <th>
                    <span>Quantity (order)</span>
                    {% include 'admin/2_product_data/partials/_sort-form.html.twig' with {'label': 'quantity (order)', 'sort_param': 'o.qty_on_order'}  %}
                  </th>
                  <th>
                    <span>Reorder</span>
                    {% include 'admin/2_product_data/partials/_sort-form.html.twig' with {'label': 'reorder level', 'sort_param': 'o.reorder_level'}  %}
                  </th>
                  <th>
                    <span>Updated</span>
                    {% include 'admin/2_product_data/partials/_sort-form.html.twig' with {'label': 'updated', 'sort_param': 'p.updated'}  %}
                  </th>
                </tr>
              </thead>
              <!-- Table body -->
              <tbody class="pswp-gallery" id="my-gallery">
              {% for product in productData %}
                <!-- Body row -->
                <tr>
                  <!-- ID -->
                  <td {% if search %} data-search-terms="{{search}}"
                      data-text="{{product.id}}" data-exact="{{(app.request.get('_exact')) ? true : false}}"
                      id="text-highlight" {% endif %}>{{product.id}}</td>
                  <!-- Thumbnail, Color & Fabrics card-->
                  <td class="table-thumbnail cell-hover">
                    <div class="row align-items-center g-0">
                      <!-- Thumbnail -->
                      <div title="List all {{product.name ~ ' (' ~ product.colors_full ~ ', ' ~ product.fabrics_full ~ ')'}}" class="col">
                        <a href="{{ path('admin_product_data_index', {'pc': product.colorId, 'pc_url': product.imageMedium, 'pc_name': product.colors_full }) }}">
                          <img  src="{{product.imageMedium ? asset(product.imageMedium)}}" class="img-fluid rounded img-border-hover" alt="...">
                        </a>
                      </div>
                      <div class="col">
                        <div class="thumbnail-body">
                          <!-- Color -->
                            <h6 class="thumbnail-title">
                              {% for color, color_full in product.colors_full_set %}
                                <a title="List all {{color_full}}" href="{{ path('admin_product_data_index', {'colors': color, 'colors_full': color_full }) }}">
                                  <span class="border-hover">{{color_full}}</span>
                                {% if not loop.last %}|{% endif %}
                                </a>
                              {% endfor %}
                              {% if product.colors_set|length > 1 %}
                              <a title="List all {{product.colors_full}}" href="{{ path('admin_product_data_index', {'colors': product.color, 'colors_full': product.colors_full }) }}">
                              <img src="{{asset( product.colors_set|length == 2  ?  'build/images/admin/two-circles.png' : 'build/images/admin/three-circles.png' )}}" class="opacity-hover-3 {{ product.colors_set|length == 2 ? 'two-circles' : 'three-circles' }}">
                              </a>
                              {% endif %}

                            </h6>

                            <!-- Fabrics -->
                            <p class="thumbnail-text">
                              {% for fabric, fabric_full in product.fabrics_full_set %}
                                <a title="List all {{fabric_full}}" href="{{ path('admin_product_data_index', {'fabrics': fabric, 'fabrics_full': fabric_full }) }}">
                                  <span class="border-hover">{{fabric_full}}</span>
                                {% if not loop.last %}|{% endif %}
                                </a>
                              {% endfor %}

                              {% if product.fabrics_full_set|length > 1 %}
                              <a title="List all {{product.fabrics_full}}" href="{{ path('admin_product_data_index', {'fabrics': product.fabrics|join('-'), 'fabrics_full': product.fabrics_full }) }}">
                                {% include '__icons/u-z/_vertical-bars.html.twig' with {'width': '20', 'height': '20', 'color': 'fill-grey'} only %}
                              </a>
                              {% endif %}
                            </p>
                          </a>
                        </div>
                      </div>
                    </div>
                  </td>
                  <!-- Brand -->
                  <td class="text-center">
                    <a title="List all {{product.brand_full}}" href="{{ path('admin_product_data_index', {'brand': product.brand}) }}">
                    <div class="table-brand-img">
                      <img
                          src="{{asset('build/images/store/color-patches/' ~ product.brand ~ '.webp') }}"
                          alt="image: {{product.brand_full}}">
                    </div>
                    </a>
                  </td>
                  <!-- Name -->
                  <td>
                    <a class="border-hover" href="{{ path('admin_product_data_index', {'product': product.productId,
                    'product_name': product.category_full ~ ' ' ~ product.name ~ ' ' ~ product.type_full}) }}">
                    <span {% if search %}
                    data-search-terms="{{search}}" data-text="{{product.category_full ~ ' ' ~ ' ' ~ product.name ~ ' ' ~ product.type_full }}"
                    data-exact="{{(app.request.get('_exact')) ? true : false}}"
                    id="text-highlight" {% endif %}>{{product.category_full ~ ' ' ~ product.name ~ ' ' ~ product.type_full }}</span>
                    </a>
                  </td>
                  <!-- Quantity -->
                  <td class="text-center">{{product.qty}} pcs</td>
                  <td>
                    <!-- Edit button -->
                    <a href="{{ path('admin_product_data_edit', {'id': product.id}) }}"><button type="button" class="btn btn-warning">edit</button></a>
                    <!-- New button -->
                    <a href="{{ path('admin_product_data_new', {'product': product.productId, 'supplier': product.supplierId}) }}"><button type="button" class="btn btn-info">new</button></a>
                    <!-- Logs button -->
                    <a href="{{ path('admin_user_visits_index', {'product': product.productId, 'product_name': product.name ~ ' ('~  product.brand_full ~ ')'}) }}"><button type="button" class="btn btn-light">logs</button></a>

                    <!-- Store button -->
                    <a href="{{ path('store_details',{ 'brand': product.brand_full|slug,'name': (product.name|title)|slug,'id': nzo_encrypt(product.id)}) }}"><button type="button" class="btn btn-success">Store</button></a>
                    <!-- Cart button -->
                    <a href="{{ path('admin_items', {'pc': product.colorId, 'pc_url': product.imageMedium, 'pc_name': product.colors_full }) }}"><button type="button" class="btn btn-dark">Cart</button></a>
                    <!-- Product button -->
                    <a href="{{ path('admin_product_show', {'id': product.productId}) }}">
                      <button type="button" class="btn btn-white">show</button>
                    </a>
                  </td>
                  <!-- Size -->
                  <td title="List all size {{product.size}}" class="text-center">
                    <a class="border-hover" {% if search %} data-search-terms="{{search}}" data-text="{{ product.size }}" data-exact="{{(app.request.get('_exact')) ? true : false}}" id="text-highlight" {% endif %} href="{{ path('admin_product_data_index', {'size': product.size}) }}">{{product.size}}</a></td>
                  <!-- Selling  Price -->
                  <td>Rs {{product.sellingPrice|number_format(2, '.', ',')}}</td>
                  <!-- Cost Price -->
                  <td>Rs {{product.costPrice|number_format(2, '.', ',')}}</td>
                  <!-- Profit -->
                  <td class="text-center">{{product.profit|format_number(style='percent', locale='en')}}</td>
                  <!-- SKU -->
                  <td>{{product.sku}}</td>
                  <!-- Supplier -->
                  <td title="List all supplier: {{product.supplier}}">
                    <a class="border-hover"s {% if search %} data-search-terms="{{search}}" data-text="{{ product.supplier }}" data-exact="{{(app.request.get('_exact')) ? true : false}}" id="text-highlight" {% endif %} href="{{ path('admin_product_data_index', {'supplier': product.supplierId, 'supplier_name': product.supplier}) }}">{{product.supplier}}
                    </a>
                  </td>
                  <!-- Qty on Order -->
                  <td class="text-center">{{ product.qtyOnOrder ? product.qtyOnOrder : '---' }}</td>
                  <!-- Reorder Level -->
                  <td class="text-center">{{ product.reorderLevel ? product.reorderLevel : '---' }}</td>
                  <!-- Updated -->
                  <td>
                    {% if product.updated %}
                      {{product.updated|format_datetime(locale='en') }}
                    {% else %}
                      <span class="text-secondary">Not yet updated</span>
                    {% endif %}
                  </td>
                </tr>
                {% else %}
                  <!-- No results message -->
                  <tr><td colspan="16" id="empty-cell" class="{{app.user.theme == 'dark' ? 'text-gray'}}">No product detail found</td></tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Pagination -->
  {% include 'admin/_partials/pagination.html.twig' with { 'items' : productData } %}
  <!-- Footer -->
  {% include 'admin/_partials/footer.html.twig' %}
</main>
